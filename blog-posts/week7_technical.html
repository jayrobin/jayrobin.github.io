<!DOCTYPE html>
<html>
	<head>
		<title>Jayrobin @ DBC</title>
		<meta charset='utf-8'>
		<link rel="shortcut icon" href="../images/favicon.ico">
		<link rel='stylesheet' href='../blog-posts/stylesheets/reset.css'>
		<link rel='stylesheet' href='../blog-posts/stylesheets/blog.css'>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-2202293-16', 'jayrobin.github.io');
      ga('send', 'pageview');

    </script>
	</head>
	<body ontouchstart>
		<header>
			<h1>JAYROBIN</h1>
			<nav>
				<ul>
					<li id='home'><a href='../index.html'>Home</a></li>
					<li id='about'><a href='../about.html'>About</a></li>
					<li id='github'><a href='http://www.github.com/jayrobin'>GitHub</a></li>
					<li id='contact'><a href='mailto:james.michael.robinson@gmail.com'>Contact</a></li>
				</ul>
			</nav>
			<h2>Or: how I learned to stop worrying and love programming</h2>
		</header>
		<main>
			<section>
				<article>
					<h3>Week Seven - Technical blog</h3>
					<span class="article_content">
						<p class='date'>19 Jul 2014</p>
						<h4>What is SQL injection?</h4>
						<p>Most websites nowadays are dynamic rather than static - they offer functionality which persists throughout multiple pages such as shopping baskets, user accounts, friends lists, etc. This persistence is most often implemented using databases, which are accessed and altered via SQL (Structured Query Language).</p>
						<p>Most websites also have various forms to allow the user to enter data: login pages, for example, where the user would enter their username and password. These forms can be used to pass SQL code into the back-end SQL queries to alter them in malicious ways.</p>


						<h4>How does it work?</h4>
						<img src='img/fb.png' class='center' />
						<p>The login page above allows a user to enter their username and password. On submitting the form, the username and password (actually, an encrypted version of the password) are sent to the website and queried against the database to check if they match. Assuming the site was using ruby in the back-end, it may build an SQL query like so:</p>

						<span class='code'>
							<span>query = "SELECT * FROM users WHERE username='#{username}' AND password='#{password}';"</span>
						</span>

						<p>If the user were to enter "someguy" for the username and "pa55w0rd" for the password, this resulting query would be:</p>

						<span class='code'>
							<span>SELECT * FROM users WHERE username='someguy' AND password='pa55w0rd';</span>
						</span>

						<p>If the password is correct for the given username, the result of this query will be a single row containing the user's account details which will be an indication to the site to allow logon. If it is incorrect, no rows will be returned and the website will display an error to the user.</p>

						<p>In this example (and on many sites), the vulnerability is due to the way the site is combining the SQL query with the data entered by the user. If there is no restriction on what characters can be entered by the user (and therefore added into the query), the query can be changed using the login form. If the user were to enter "' OR '1'='1" in the password field, it would result in the following SQL query:</p>
						<span class='code'>
							<span>query = "SELECT * FROM users WHERE username='#{username}' AND password='#{password}';"</span>
							<span>SELECT * FROM users WHERE username='someguy' AND password='' OR '1'='1';</span>
						</span>
						<p>Since the latter condition will always be true, the result of this query will be the entirety of the users database - depending on how the back-end used this data, this could allow the user to login as anyone.</p>
						<p>SQL injection can also be used to change the data by terminating queries and executing new ones. For example,  if the user entered the password "'; UPDATE users SET password='password' WHERE username='admin":</p>
						<span class='code'>
							<span>query = "SELECT * FROM users WHERE username='#{username}' AND password='#{password}';"</span>
							<span>SELECT * FROM users WHERE username='someguy' AND password='';</span>
							<span>UPDATE users SET password='password' WHERE username LIKE '%admin%';</span>
						</span>
						<p>The above query would change the 'admin' account password to 'password', allowing the attacker to easily login and start making more destructive changes.</p>
						<p>SQL injection could also be used to delete data entirely (see also, <a href=''>XKCD - Little Bobby Tables</a>):</p>
						<span class='code'>
							<span>query = "SELECT * FROM users WHERE username='#{username}' AND password='#{password}';"</span>
							<span>SELECT * FROM users WHERE username='someguy' AND password='';</span>
							<span>DROP TABLE users;--</span>
						</span>
						<p>The above query will entirely delete the users database - hopefully they had backups!</p>


						<h4>How can it be prevented?</h4>
						<p>The most basic method of prevention is to sanatize data before it is integrated with a SQL query: this most commonly involves escaping certain characters, such as single quotes. In our example above, escaped characters will prevent the password string from altering the SQL query:</p>
						<span class='code'>
							<span>SELECT * FROM users WHERE username='someguy' AND password='\' OR \'1\'=\'1';</span>
						</span>
						<p>The query above would return zero results, unless of course the users password was actually "\' OR \'1\'=\'1".</p>

						<p>Parameterized statements can also be used to prevent SQL injection - these work by keeping the user-entered data separate from the SQL query and pass them in like parameters into a method:</p>

						<span class='code'>
							<span>query = db.prepare "SELECT * FROM users WHERE username=? AND password=?;"</span>
							<span>query.execute username, password</span>
						</span>

						<p>Type and pattern checking can be used to confirm that data being passed in is of a specific type or matches a given pattern (e.g. ##/##/#### for date of birth, strings with certain allowable characters for usernames).</p>

						<p>Finally, limited access privileges can be granted to different areas of the application: for example, only allowing 'SELECT' queries to be executed from the login form.</p>



				</article>
			</section>
		</main>
		<footer>
			<nav>
				<ul>
					<li>
						<a href='https://www.facebook.com/jamesmichaelrobinson'>
							<span aria-hidden="true" data-icon="&#xe602;"></span>
							<span class="screen-reader">Facebook</span>
						</a>
					</li>
					<li>
						<a href='https://plus.google.com/u/0/112484955141279120302/'>
							<span aria-hidden="true" data-icon="&#xe601;"></span>
							<span class="screen-reader">Google+</span>
						</a>
					</li>
					<li>
						<a href='https://twitter.com/jayrob_in'>
							<span aria-hidden="true" data-icon="&#xe603;"></span>
							<span class="screen-reader">Twitter</span>
						</a>
					</li>
					<li>
						<a href='http://www.github.com/jayrobin'>
							<span aria-hidden="true" data-icon="&#xe604;"></span>
							<span class="screen-reader">GitHub</span>
						</a>
					</li>
					<li>
						<a href='http://uk.linkedin.com/in/jayrobin'>
							<span aria-hidden="true" data-icon="&#xe605;"></span>
							<span class="screen-reader">LinkedIn</span>
						</a>
					</li>
					<li>
						<a href='mailto:james.michael.robinson@gmail.com'>
							<span aria-hidden="true" data-icon="&#xe600;"></span>
							<span class="screen-reader">Email</span>
						</a>
					</li>
				</ul>
			</nav>
		</footer>
	</body>
</html>